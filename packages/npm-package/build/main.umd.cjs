(function(i,_){typeof exports=="object"&&typeof module<"u"?_(exports,require("react"),require("recoil")):typeof define=="function"&&define.amd?define(["exports","react","recoil"],_):(i=typeof globalThis<"u"?globalThis:i||self,_(i.RecoilInspector={},i.react,i.recoil))})(this,function(i,_,a){"use strict";const T=({action:e,payload:n})=>{window.postMessage({action:e,payload:n},"*")},l=Object.values({USE_STATE:"useState",USE_CONTEXT:"useContext"}),f=["Batcher"];function I(e){return!f.includes(e.elementType.name)}function N(e){var t;return e.type&&typeof e.type=="function"?!!((t=e._debugHookTypes)==null?void 0:t.find(s=>l.includes(s))):!1}function p(e){return typeof e=="object"&&e.baseState===null}function C(e){const n=[];let o=e.memoizedState;for(;o;)o.memoizedState&&!o.memoizedState.tagName&&!p(o)&&n.push(o.memoizedState),o=o.next;return n}const c=(e,n)=>{var R,d;const o=((R=e.elementType)==null?void 0:R.name)!=="RecoilInspector",t=N(e)&&I(e)&&o,s=[],E=[];O(e.memoizedState,s,E);const r=t?u({name:(d=e.elementType)==null?void 0:d.name,hookTypes:[...e._debugHookTypes],memoizedState:void 0,states:C(e),recoilStates:s,originalNodeData:void 0}):null;if(r&&n.children.push(r),e.child){const b=r||n;c(e.child,b)}e.sibling&&c(e.sibling,n)},O=(e,n,o)=>(!e||o.indexOf(e)!==-1||(o.push(e),e.key&&n.push({key:e.key,deps:e.deps||[]}),e.memoizedState&&o.indexOf(e.memoizedState)===-1&&(O(e.memoizedState,n,o),o.push(e.memoizedState)),e.next&&o.indexOf(e.next)===-1&&(O(e.next,n,o),o.push(e.next)),!e.memoizedState&&!e.next),null),u=({name:e,hookTypes:n,originalNodeData:o,memoizedState:t,recoilStates:s,states:E})=>{const r=Date.now();return{name:e,hookTypes:n,children:[],originalNodeData:o?{...o}:void 0,memoizedState:t,states:E,recoilStates:s,createdAt:r}};function S(){return process.env.NODE_ENV!=="development"||(w({onFiberRootUpdate:F}),a.useRecoilTransactionObserver_UNSTABLE(function({snapshot:n}){const o=[];for(const t of n.getNodes_UNSTABLE())o.push({key:t.key,value:n.getLoadable(t).getValue(),stateType:n.getInfo_UNSTABLE(t).type});window.__RECOIL_INSPECTOR_RECOIL_STATES=o,g(),window.__RECOIL_INSPECTOR_COMPONENT_TREE_ROOT.id=window.__RECOIL_INSPECTOR_FIBER_ROOT_ID,T({action:"extensionDataUpdated",payload:{componentTreeRoot:window.__RECOIL_INSPECTOR_COMPONENT_TREE_ROOT,recoilStates:window.__RECOIL_INSPECTOR_RECOIL_STATES}})}),_.useEffect(function(){window.addEventListener("message",n=>{console.log("got a message from the extension",n.data),n.data.type==="frontendLoaded"&&window.__RECOIL_INSPECTOR_COMPONENT_TREE_ROOT&&window.__RECOIL_INSPECTOR_COMPONENT_TREE_ROOT&&(console.log("sending data to the extension"),T({action:"extensionDataUpdated",payload:{componentTreeRoot:window.__RECOIL_INSPECTOR_COMPONENT_TREE_ROOT,recoilStates:window.__RECOIL_INSPECTOR_RECOIL_STATES}}))})},[])),null}function w({onFiberRootUpdate:e}){_.useEffect(function(){if(!window)return;const o=window.__REACT_DEVTOOLS_GLOBAL_HOOK__;o.onCommitFiberRoot=L(o.onCommitFiberRoot,e)},[])}function L(e,n){return function(...t){const s=window.__REACT_DEVTOOLS_GLOBAL_HOOK__.getFiberRoots(1).values().next().value.current;return n(s),e(...t)}}function F(e){const n=u({name:"root"});c(e,n),window.__RECOIL_INSPECTOR_COMPONENT_TREE_ROOT=n}function g(){window.__RECOIL_INSPECTOR_FIBER_ROOT_ID===void 0?window.__RECOIL_INSPECTOR_FIBER_ROOT_ID=0:window.__RECOIL_INSPECTOR_FIBER_ROOT_ID=window.__RECOIL_INSPECTOR_FIBER_ROOT_ID+1}i.convertFiberToDebuggerComponentTree=c,i.createNode=u,i.default=S,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
